<h1>Photo Details</h1>

<table border="1" width="100%" style="margin-bottom: 1em;">
  <tbody>
    <!-- Image -->
    <tr>
      <th>Image</th>
      <td style="text-align:center">
        <% if @photo.image.present? %>
          <%= image_tag @photo.image, width: 400, alt: "photo" %>
        <% else %>
          (no image)
        <% end %>
      </td>
    </tr>

    <!-- Caption -->
    <tr>
      <th>Caption</th>
      <td><%= @photo.caption.presence || "(no caption)" %></td>
    </tr>

    <!-- Owner -->
    <tr>
      <th>Owner</th>
      <td><%= @photo.owner.username %></td>
    </tr>

    <!-- Posted -->
    <tr>
      <th>Posted</th>
      <td><%= time_ago_in_words(@photo.created_at) %> ago</td>
    </tr>

    <!-- Likes count -->
    <tr>
      <th>Likes count</th>
      <td><%= @photo.likes_count %></td>
    </tr>

    <!-- Comments count -->
    <tr>
      <th>Comments count</th>
      <td><%= @photo.comments_count %></td>
    </tr>

    <!-- Fans (usernames of everybody whoâ€™s liked it) -->
    <tr>
      <th>Fans</th>
      <td><%= @photo.likes.map { |l| l.fan.username }.to_sentence %></td>
    </tr>

    <!-- Add a fan / remove a fan -->
    <tr>
      <th>Add a fan</th>
      <td>
        <% if user_signed_in? %>
          <% existing_like = @photo.likes.find_by(fan: current_user) %>
          <% if existing_like %>
            <%= link_to "Unlike", photo_like_path(@photo, existing_like), method: :delete %>
          <% else %>
            <%= button_to "Like", photo_likes_path(@photo), method: :post %>
          <% end %>
        <% end %>
      </td>
    </tr>
  </tbody>
</table>

<h2>Comments</h2>
<table border="1" width="100%">
  <thead>
    <tr>
      <th>Commenter</th>
      <th>Comment</th>
      <th>Posted</th>
    </tr>
  </thead>
  <tbody>
    <% @comments.each do |c| %>
      <tr>
        <td><%= c.author.username %></td>
        <td><%= c.body %></td>
        <td><%= time_ago_in_words(c.created_at) %> ago</td>
      </tr>
    <% end %>
  </tbody>
</table>
